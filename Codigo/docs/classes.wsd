@startuml classes
skinparam packageStyle rectangle

package "Presentation" <<Rectangle>> {
    class HookciCli <<CLI>> {
        + init()
        + run()
        + migrate()
        + main()
    }

    class PipelineUI <<UI>> {
        + handle_event()
    }

    class DebugUI <<UI>> {
        + handle_event()
    }
}

package "Application" <<Rectangle>> {
    class ProjectInitService <<Service>> {
        + run()
    }

    class CiExecutionService <<Service>> {
        + run()
    }

    class MigrationService <<Service>> {
        + run()
    }

    package "events" {
        interface PipelineEvent <<DTO>>
    }
}

package "Domain" <<Rectangle>> {
    class Configuration <<Model>> {
        + version
        + log_level
        + docker
        + hooks
        + filters
        + steps
        + validate_dag()
    }
}

package "Infrastructure" <<Rectangle>> {
    interface IFileSystem <<Interface>> {
        + file_exists()
        + create_dir()
        + write_file()
        + read_file()
        + make_executable()
    }
    class LocalFileSystem <<Implementation>> {
        + file_exists()
        + create_dir()
        + write_file()
        + read_file()
        + make_executable()
    }

    interface IScmService <<Interface>> {
        + git_root
        + set_hooks_path()
        + get_current_branch()
        + get_staged_commit_message()
    }
    class GitService <<Implementation>> {
        + git_root
        + set_hooks_path()
        + get_current_branch()
        + get_staged_commit_message()
    }

    interface IDockerService <<Interface>> {
        + image_exists()
        + pull_image()
        + run_command_in_container()
        + build_image()
        + count_dockerfile_steps()
        + calculate_dockerfile_hash()
        + start_persistent_container()
        + exec_in_container()
        + stop_and_remove_container()
    }
    class DockerService <<Implementation>> {
        + image_exists()
        + pull_image()
        + run_command_in_container()
        + build_image()
        + count_dockerfile_steps()
        + calculate_dockerfile_hash()
        + start_persistent_container()
        + exec_in_container()
        + stop_and_remove_container()
    }

    interface IConfigHandler <<Interface>> {
        + load_config_data()
        + write_config_data()
    }
    class YamlConfigHandler <<Implementation>> {
        + load_config_data()
        + write_config_data()
    }

    LocalFileSystem .up.|> IFileSystem
    GitService .up.|> IScmService
    DockerService .up.|> IDockerService
    YamlConfigHandler .up.|> IConfigHandler
}

HookciCli .down.> ProjectInitService
HookciCli .down.> CiExecutionService
HookciCli .down.> MigrationService
PipelineUI ..> PipelineEvent
DebugUI ..> PipelineEvent

ProjectInitService ..> Configuration
CiExecutionService ..> Configuration
MigrationService ..> Configuration

ProjectInitService --> IScmService
ProjectInitService --> IFileSystem
ProjectInitService --> IConfigHandler

CiExecutionService --> IScmService
CiExecutionService --> IConfigHandler
CiExecutionService --> IDockerService
CiExecutionService --> IFileSystem

MigrationService --> IScmService
MigrationService --> IConfigHandler

GitService --> IFileSystem
YamlConfigHandler --> IFileSystem

@enduml